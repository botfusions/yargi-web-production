<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yargı Web - Türk Hukuk Arama Motoru</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
        }

        .hero-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin: 2rem 0;
            padding: 3rem;
            text-align: center;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .search-container {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin: 2rem 0;
        }

        .database-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-left: 4px solid var(--secondary-color);
            transition: all 0.3s ease;
        }

        .database-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .database-card.active {
            border-left-color: var(--accent-color);
            background: #f8f9fa;
        }

        .search-btn {
            background: var(--bg-gradient);
            border: none;
            border-radius: 50px;
            padding: 12px 30px;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            color: white;
        }

        .results-container {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .result-item {
            border-bottom: 1px solid #eee;
            padding: 1.5rem 0;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .loading-spinner {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .database-icon {
            font-size: 1.5rem;
            color: var(--secondary-color);
            margin-right: 1rem;
        }

        .api-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 0.9rem;
        }

        .api-status.online {
            background: rgba(46, 125, 50, 0.9);
        }

        .api-status.offline {
            background: rgba(211, 47, 47, 0.9);
        }

        .error-message {
            background: #ffebee;
            border: 1px solid #ffcdd2;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            color: #c62828;
        }

        .success-message {
            background: #e8f5e8;
            border: 1px solid #c8e6c9;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            color: #2e7d32;
        }
    </style>
</head>
<body>
    <!-- API Status Indicator -->
    <div id="apiStatus" class="api-status offline">
        <i class="fas fa-wifi"></i> API Bağlantısı Kontrol Ediliyor...
    </div>

    <div class="container">
        <!-- Hero Section -->
        <div class="hero-section">
            <h1 class="display-4 mb-4">
                <i class="fas fa-balance-scale me-3"></i>
                Yargı Web
            </h1>
            <p class="lead">Türkiye'nin En Kapsamlı Hukuki Karar Arama Motoru</p>
            <p class="mb-0">Yargıtay, Danıştay, Anayasa Mahkemesi ve daha fazlası...</p>
        </div>

        <!-- Search Container -->
        <div class="search-container">
            <h3 class="mb-4">
                <i class="fas fa-search me-2"></i>
                Hukuki Karar Arama
            </h3>

            <form id="searchForm">
                <div class="row">
                    <div class="col-md-8 mb-3">
                        <label for="searchKeyword" class="form-label">Arama Terimi</label>
                        <input type="text" class="form-control form-control-lg" 
                               id="searchKeyword" 
                               placeholder="Örn: iş hukuku, tazminat, boşanma..." 
                               required>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="resultLimit" class="form-label">Sonuç Sayısı</label>
                        <select class="form-control form-control-lg" id="resultLimit">
                            <option value="5">5 Sonuç</option>
                            <option value="10" selected>10 Sonuç</option>
                            <option value="20">20 Sonuç</option>
                            <option value="50">50 Sonuç</option>
                        </select>
                    </div>
                </div>

                <div class="text-center">
                    <button type="submit" class="btn search-btn btn-lg">
                        <i class="fas fa-search me-2"></i>
                        Ara
                    </button>
                </div>
            </form>
        </div>

        <!-- Database Selection -->
        <div class="row">
            <div class="col-12">
                <h4 class="text-white mb-4">
                    <i class="fas fa-database me-2"></i>
                    Arama Yapılacak Veritabanları
                </h4>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="database-card" data-db="yargitay">
                    <i class="fas fa-gavel database-icon"></i>
                    <strong>Yargıtay</strong>
                    <small class="text-muted d-block">Yargıtay (Temyiz Mahkemesi)</small>
                </div>
                <div class="database-card" data-db="danistay">
                    <i class="fas fa-landmark database-icon"></i>
                    <strong>Danıştay</strong>
                    <small class="text-muted d-block">İdari Yargı Temyiz Mahkemesi</small>
                </div>
                <div class="database-card" data-db="anayasa">
                    <i class="fas fa-scroll database-icon"></i>
                    <strong>Anayasa Mahkemesi</strong>
                    <small class="text-muted d-block">Anayasal Denetim ve Bireysel Başvuru</small>
                </div>
                <div class="database-card" data-db="emsal">
                    <i class="fas fa-book database-icon"></i>
                    <strong>Emsal Kararlar</strong>
                    <small class="text-muted d-block">UYAP İçtihat Veritabanı</small>
                </div>
            </div>
            <div class="col-md-6">
                <div class="database-card" data-db="rekabet">
                    <i class="fas fa-chart-line database-icon"></i>
                    <strong>Rekabet Kurumu</strong>
                    <small class="text-muted d-block">Rekabet Hukuku Kararları</small>
                </div>
                <div class="database-card" data-db="kik">
                    <i class="fas fa-handshake database-icon"></i>
                    <strong>Kamu İhale Kurulu</strong>
                    <small class="text-muted d-block">Kamu İhalesi Uyuşmazlıkları</small>
                </div>
                <div class="database-card" data-db="sayistay">
                    <i class="fas fa-calculator database-icon"></i>
                    <strong>Sayıştay</strong>
                    <small class="text-muted d-block">Mali Denetim ve Hesap Verebilirlik</small>
                </div>
                <div class="database-card" data-db="kvkk">
                    <i class="fas fa-shield-alt database-icon"></i>
                    <strong>KVKK</strong>
                    <small class="text-muted d-block">Kişisel Verileri Koruma Kurulu</small>
                </div>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="loading-spinner">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Aranıyor...</span>
            </div>
            <p class="mt-3">Hukuki kararlar aranıyor...</p>
        </div>

        <!-- Results Container -->
        <div id="resultsContainer" class="results-container">
            <h4 class="mb-4">
                <i class="fas fa-list-alt me-2"></i>
                Arama Sonuçları
            </h4>
            <div id="resultsContent"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE_URL = 'http://185.170.196.65:8002';
        
        // Database selection
        let selectedDatabases = ['emsal']; // Default to working database
        
        // API Status Check
        async function checkApiStatus() {
            const statusElement = document.getElementById('apiStatus');
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                if (response.ok) {
                    statusElement.className = 'api-status online';
                    statusElement.innerHTML = '<i class="fas fa-check-circle"></i> API Çevrimiçi';
                } else {
                    throw new Error('API yanıt vermiyor');
                }
            } catch (error) {
                statusElement.className = 'api-status offline';
                statusElement.innerHTML = '<i class="fas fa-exclamation-triangle"></i> API Çevrimdışı';
            }
        }

        // Database card selection
        document.querySelectorAll('.database-card').forEach(card => {
            card.addEventListener('click', function() {
                this.classList.toggle('active');
                const dbName = this.dataset.db;
                
                if (this.classList.contains('active')) {
                    if (!selectedDatabases.includes(dbName)) {
                        selectedDatabases.push(dbName);
                    }
                } else {
                    selectedDatabases = selectedDatabases.filter(db => db !== dbName);
                }
                
                console.log('Selected databases:', selectedDatabases);
            });
        });

        // Search functionality
        document.getElementById('searchForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const keyword = document.getElementById('searchKeyword').value.trim();
            const limit = document.getElementById('resultLimit').value;
            
            if (!keyword) {
                showMessage('Lütfen bir arama terimi girin.', 'error');
                return;
            }

            if (selectedDatabases.length === 0) {
                showMessage('Lütfen en az bir veritabanı seçin.', 'error');
                return;
            }

            showLoading(true);
            hideResults();

            try {
                // Get real tools and databases info
                const [toolsResponse, dbResponse] = await Promise.all([
                    fetch(`${API_BASE_URL}/api/tools`),
                    fetch(`${API_BASE_URL}/api/databases`)
                ]);
                
                if (toolsResponse.ok && dbResponse.ok) {
                    const toolsData = await toolsResponse.json();
                    const dbData = await dbResponse.json();
                    
                    // Show real API data instead of mock
                    displayRealApiData(keyword, toolsData, dbData, limit);
                    
                    showMessage(`"${keyword}" için API bilgileri gösteriliyor. (Not: Arama endpoint'leri geçici olarak bakımda)`, 'success');
                } else {
                    throw new Error('API yanıt vermiyor');
                }
                
            } catch (error) {
                console.error('API hatası:', error);
                showMessage('API bağlantı hatası. POST endpoint\'leri şu anda çalışmıyor.', 'error');
                
                // Fallback to mock data
                const mockResults = generateMockResults(keyword, limit);
                displayResults(mockResults, keyword);
            } finally {
                showLoading(false);
            }
        });

        function displayRealApiData(keyword, toolsData, dbData, limit) {
            const container = document.getElementById('resultsContent');
            
            const apiInfo = `
                <div class="row mb-4">
                    <div class="col-md-6">
                        <h5><i class="fas fa-tools me-2"></i>Mevcut Tools (${toolsData.length})</h5>
                        <div class="list-group">
                            ${toolsData.slice(0, 5).map(tool => `
                                <div class="list-group-item">
                                    <strong>${tool.name}</strong>
                                    <small class="text-muted d-block">${tool.description}</small>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h5><i class="fas fa-database me-2"></i>Veritabanları</h5>
                        <div class="list-group">
                            ${Object.keys(dbData).slice(0, 5).map(dbKey => `
                                <div class="list-group-item">
                                    <strong>${dbData[dbKey].name}</strong>
                                    <small class="text-muted d-block">${dbData[dbKey].description}</small>
                                    <small class="badge bg-primary">${dbData[dbKey].tools || 0} tools</small>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>API Durumu:</strong> GET endpoint'leri çalışıyor, POST endpoint'leri geliştiriliyor.
                    <br><strong>Arama terimi:</strong> "${keyword}" - ${limit} sonuç talep edildi.
                </div>
            `;
            
            container.innerHTML = apiInfo;
            showResults();
        }
            const courts = ['Yargıtay', 'Danıştay', 'Anayasa Mahkemesi', 'Emsal'];
            const results = [];
            
            for (let i = 1; i <= Math.min(limit, 10); i++) {
                results.push({
                    id: `mock-${i}`,
                    title: `${keyword.toUpperCase()} ile ilgili karar ${i}`,
                    court: courts[Math.floor(Math.random() * courts.length)],
                    date: `2024-${String(Math.floor(Math.random() * 12) + 1).padStart(2, '0')}-${String(Math.floor(Math.random() * 28) + 1).padStart(2, '0')}`,
                    summary: `Bu karar ${keyword} konusunda önemli bir içtihat oluşturmaktadır. Mahkeme, bu konuda detaylı bir değerlendirme yapmış ve emsal teşkil edecek bir karar vermiştir.`,
                    number: `${new Date().getFullYear()}/${Math.floor(Math.random() * 10000) + 1000}`
                });
            }
            
            return results;
        }

        function displayResults(results, keyword) {
            const container = document.getElementById('resultsContent');
            
            if (results.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-muted">
                        <i class="fas fa-search fa-3x mb-3"></i>
                        <h5>"${keyword}" için sonuç bulunamadı</h5>
                        <p>Farklı anahtar kelimeler deneyebilir veya arama kriterlerinizi genişletebilirsiniz.</p>
                    </div>
                `;
            } else {
                container.innerHTML = results.map(result => `
                    <div class="result-item">
                        <div class="row">
                            <div class="col-md-8">
                                <h6 class="mb-2">
                                    <i class="fas fa-file-alt me-2 text-primary"></i>
                                    ${result.title}
                                </h6>
                                <p class="mb-2 text-muted">${result.summary}</p>
                                <small class="text-muted">
                                    <i class="fas fa-landmark me-1"></i> ${result.court} |
                                    <i class="fas fa-calendar me-1"></i> ${result.date} |
                                    <i class="fas fa-hashtag me-1"></i> ${result.number}
                                </small>
                            </div>
                            <div class="col-md-4 text-end">
                                <button class="btn btn-outline-primary btn-sm mb-2" onclick="viewDocument('${result.id}')">
                                    <i class="fas fa-eye me-1"></i> Görüntüle
                                </button>
                                <br>
                                <button class="btn btn-outline-secondary btn-sm" onclick="downloadDocument('${result.id}')">
                                    <i class="fas fa-download me-1"></i> İndir
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            showResults();
        }

        function viewDocument(id) {
            showMessage(`Doküman ${id} görüntüleniyor...`, 'success');
            // Implement document viewing
        }

        function downloadDocument(id) {
            showMessage(`Doküman ${id} indiriliyor...`, 'success');
            // Implement document download
        }

        function showLoading(show) {
            document.getElementById('loadingSpinner').style.display = show ? 'block' : 'none';
        }

        function showResults() {
            document.getElementById('resultsContainer').style.display = 'block';
        }

        function hideResults() {
            document.getElementById('resultsContainer').style.display = 'none';
        }

        function showMessage(message, type) {
            // Remove existing messages
            document.querySelectorAll('.error-message, .success-message').forEach(el => el.remove());
            
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
            messageDiv.innerHTML = `<i class="fas fa-${type === 'error' ? 'exclamation-triangle' : 'check-circle'} me-2"></i>${message}`;
            
            const container = document.querySelector('.search-container');
            container.appendChild(messageDiv);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkApiStatus();
            // Set emsal as default selected
            document.querySelector('[data-db="emsal"]').classList.add('active');
            
            // Check API status every 30 seconds
            setInterval(checkApiStatus, 30000);
        });
    </script>
</body>
</html>
